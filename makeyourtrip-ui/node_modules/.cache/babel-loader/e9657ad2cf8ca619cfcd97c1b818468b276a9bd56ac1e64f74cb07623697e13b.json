{"ast":null,"code":"\"use strict\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.verify = void 0;\nvar crypto_1 = require(\"crypto\");\nvar lodash_1 = require(\"lodash\");\nvar errorMessages_1 = __importDefault(require(\"../libs/constants/errorMessages\"));\n/**\n * @description Enum for Webhook signature item names\n */\nvar SignatureItems;\n(function (SignatureItems) {\n  SignatureItems[\"Timestamp\"] = \"t\";\n  SignatureItems[\"V1\"] = \"v1\";\n})(SignatureItems || (SignatureItems = {}));\nvar HASH_ALGORITHM = \"sha256\";\n/**\n * @param timstamp - Webhook request timestamp\n * @param payload - Webhook payload as UTF8 encoded string\n * @param secret - Webhook secret as UTF8 encoded string\n * @returns Hmac with webhook secret as key and `${timestamp}.${payload}` as hash payload.\n */\nvar computeHmac = function (timstamp, payload, secret) {\n  var hashPayload = \"\".concat(timstamp.getTime(), \".\").concat(payload);\n  return (0, crypto_1.createHmac)(HASH_ALGORITHM, secret).update(hashPayload).digest(\"hex\");\n};\n/**\n * @description Extract items from webhook signature string\n */\nvar deserializeSignature = function (signature) {\n  var _a, _b;\n  var items = signature.split(\",\");\n  var itemMap = items.map(function (item) {\n    return item.split(\"=\");\n  }); // eg. [[\"t\", 1656921250765], [\"v1\", 'afafafafafaf']]\n  var timestampString = (_a = itemMap.find(function (_a) {\n    var _b = __read(_a, 1),\n      key = _b[0];\n    return key === SignatureItems.Timestamp;\n  })) === null || _a === void 0 ? void 0 : _a[1]; // eg. 1656921250765\n  // parse timestamp\n  if (timestampString === undefined) {\n    throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_TIMESTAMP_MISSING.message);\n  }\n  var timestamp = parseInt(timestampString, 10);\n  if ((0, lodash_1.isNaN)(timestamp) || timestamp < 0) {\n    throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_TIMESTAMP_INVALID.message);\n  }\n  // parse v1 signature\n  var v1 = (_b = itemMap.find(function (_a) {\n    var _b = __read(_a, 1),\n      key = _b[0];\n    return key === SignatureItems.V1;\n  })) === null || _b === void 0 ? void 0 : _b[1]; // eg. 'afafafafafaf'\n  if (v1 === undefined) {\n    throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_SIGNATURE_MISSING.message);\n  }\n  return {\n    timestamp: timestamp,\n    v1: v1\n  };\n};\n/**\n * @param payload - Raw webhook request body (Encoded as UTF8 string or Buffer)\n * @param signature - Webhook signature as UTF8 encoded strings (Stored in `x-ik-signature` header of the request)\n * @param secret - Webhook secret as UTF8 encoded string [Copy from ImageKit dashboard](https://imagekit.io/dashboard/developer/webhooks)\n * @returns \\{ `timstamp`: Verified UNIX epoch timestamp if signature, `event`: Parsed webhook event payload \\}\n */\nvar verify = function (payload, signature, secret) {\n  var _a = deserializeSignature(signature),\n    timestamp = _a.timestamp,\n    v1 = _a.v1;\n  var payloadAsString = typeof payload === \"string\" ? payload : Buffer.from(payload).toString(\"utf8\");\n  var computedHmac = computeHmac(new Date(timestamp), payloadAsString, secret);\n  if (v1 !== computedHmac) {\n    throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_SIGNATURE_INCORRECT.message);\n  }\n  return {\n    timestamp: timestamp,\n    event: JSON.parse(payloadAsString)\n  };\n};\nexports.verify = verify;","map":{"version":3,"names":["__read","o","n","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","__importDefault","mod","__esModule","Object","defineProperty","exports","verify","crypto_1","require","lodash_1","errorMessages_1","SignatureItems","HASH_ALGORITHM","computeHmac","timstamp","payload","secret","hashPayload","concat","getTime","createHmac","update","digest","deserializeSignature","signature","_a","_b","items","split","itemMap","map","item","timestampString","find","key","Timestamp","undefined","Error","default","VERIFY_WEBHOOK_EVENT_TIMESTAMP_MISSING","message","timestamp","parseInt","isNaN","VERIFY_WEBHOOK_EVENT_TIMESTAMP_INVALID","v1","V1","VERIFY_WEBHOOK_EVENT_SIGNATURE_MISSING","payloadAsString","Buffer","from","toString","computedHmac","Date","VERIFY_WEBHOOK_EVENT_SIGNATURE_INCORRECT","event","JSON","parse"],"sources":["E:/big_bang_assesment_tourism/makeyourtrip-ui/node_modules/imagekit/dist/utils/webhook-signature.js"],"sourcesContent":["\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.verify = void 0;\nvar crypto_1 = require(\"crypto\");\nvar lodash_1 = require(\"lodash\");\nvar errorMessages_1 = __importDefault(require(\"../libs/constants/errorMessages\"));\n/**\n * @description Enum for Webhook signature item names\n */\nvar SignatureItems;\n(function (SignatureItems) {\n    SignatureItems[\"Timestamp\"] = \"t\";\n    SignatureItems[\"V1\"] = \"v1\";\n})(SignatureItems || (SignatureItems = {}));\nvar HASH_ALGORITHM = \"sha256\";\n/**\n * @param timstamp - Webhook request timestamp\n * @param payload - Webhook payload as UTF8 encoded string\n * @param secret - Webhook secret as UTF8 encoded string\n * @returns Hmac with webhook secret as key and `${timestamp}.${payload}` as hash payload.\n */\nvar computeHmac = function (timstamp, payload, secret) {\n    var hashPayload = \"\".concat(timstamp.getTime(), \".\").concat(payload);\n    return (0, crypto_1.createHmac)(HASH_ALGORITHM, secret).update(hashPayload).digest(\"hex\");\n};\n/**\n * @description Extract items from webhook signature string\n */\nvar deserializeSignature = function (signature) {\n    var _a, _b;\n    var items = signature.split(\",\");\n    var itemMap = items.map(function (item) { return item.split(\"=\"); }); // eg. [[\"t\", 1656921250765], [\"v1\", 'afafafafafaf']]\n    var timestampString = (_a = itemMap.find(function (_a) {\n        var _b = __read(_a, 1), key = _b[0];\n        return key === SignatureItems.Timestamp;\n    })) === null || _a === void 0 ? void 0 : _a[1]; // eg. 1656921250765\n    // parse timestamp\n    if (timestampString === undefined) {\n        throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_TIMESTAMP_MISSING.message);\n    }\n    var timestamp = parseInt(timestampString, 10);\n    if ((0, lodash_1.isNaN)(timestamp) || timestamp < 0) {\n        throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_TIMESTAMP_INVALID.message);\n    }\n    // parse v1 signature\n    var v1 = (_b = itemMap.find(function (_a) {\n        var _b = __read(_a, 1), key = _b[0];\n        return key === SignatureItems.V1;\n    })) === null || _b === void 0 ? void 0 : _b[1]; // eg. 'afafafafafaf'\n    if (v1 === undefined) {\n        throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_SIGNATURE_MISSING.message);\n    }\n    return { timestamp: timestamp, v1: v1 };\n};\n/**\n * @param payload - Raw webhook request body (Encoded as UTF8 string or Buffer)\n * @param signature - Webhook signature as UTF8 encoded strings (Stored in `x-ik-signature` header of the request)\n * @param secret - Webhook secret as UTF8 encoded string [Copy from ImageKit dashboard](https://imagekit.io/dashboard/developer/webhooks)\n * @returns \\{ `timstamp`: Verified UNIX epoch timestamp if signature, `event`: Parsed webhook event payload \\}\n */\nvar verify = function (payload, signature, secret) {\n    var _a = deserializeSignature(signature), timestamp = _a.timestamp, v1 = _a.v1;\n    var payloadAsString = typeof payload === \"string\"\n        ? payload\n        : Buffer.from(payload).toString(\"utf8\");\n    var computedHmac = computeHmac(new Date(timestamp), payloadAsString, secret);\n    if (v1 !== computedHmac) {\n        throw new Error(errorMessages_1.default.VERIFY_WEBHOOK_EVENT_SIGNATURE_INCORRECT.message);\n    }\n    return {\n        timestamp: timestamp,\n        event: JSON.parse(payloadAsString),\n    };\n};\nexports.verify = verify;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}